---
title: "Races or Tournaments?"
author: 
    - Andrea Blasco
    - K. J. Boudreau
    - M. Menietti
    - K. R. Lakhani
date: "This version: `r format(Sys.Date(),'%B %d, %Y')`" 
bibliography: ~/Papers/library.bib
header-includes:
    - \input{../definitions.txt}
    - \input{Assets/config.tex}
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(
  cache=TRUE,
  echo=FALSE,
  message=FALSE,
  warning=TRUE,
  error=FALSE,
  tidy=FALSE,
  fig.width=5,
  fig.height=5,
  cache.path="Cache/",
  fig.path="Figures/")
```



Introduction
====================


Known to us for thousands of years
----------------------------------------

\begin{figure}
\includegraphics[width=0.5\textwidth]{img/runners.jpg}\\
\includegraphics[width=0.5\textwidth]{img/wrestlers.jpg}
\caption{Runners (top) and wrestlers (bottom) c. 500 bc.}
\end{figure}


Descriptive of many economic situations
----------------------------------------

Traditional economics: 

- Between nations: \emph{arms races, space races, wars}
- Between firms: \emph{patent races, rent seeking contests}
- Inside firms: \emph{sales contests, promotions}

More recently: 

- Digital revolution $\leadsto$ lower costs to set up contests $\leadsto$ "Race or tournaments" is not exogenous parameter but a choice of contest design

A concrete example
----------------------------------------

- Problem: UK government and Eu commission want solutions to antibiotic resistance problem
- Open innovation contest approach looks good:
    * long tail distribution of potential solvers
    * cheaper than direct hiring

- EU choice is a "tournament" (The Horizon Prize)
    * the best solution within the next 5 years wins a prize
- UK choice is a "race" (The Longitude Prize)
    * the first to meet a given requirement wins a prize

Why to go with one or the other?
----------------------------------------

Potential gains of a race

- Get ideas more quickly (speed)
- Stop duplicative efforts once a minimum target has been achieved (efficiency)
- Supplement competition when lacking of intensity (incentives)

Potential costs of a race

- Lower participation
- Lower expected quality

This paper
====================

In this paper
----------------------------------------

- Extend contest model of @moldovanu2001optimal to have both in one framework

- Design and run experiment to collect data to estimate the model and provide policy recommendations. 

The model 
=============

Model highlights
-----------------

- $k=1,..., K$ prizes available of value $V_1>V_2>...>V_K$

- Each agent, $(i=1, ..., I)$, exerts "multidimensional" efforts
    + time to completion $t_i$
    + output quality $y_i$
- Private ability iid $a\sim F$ on support $A\subset[0, \infty)$
- Maximize chances of winning minus costs
\begin{equation}
  C(y_i, t_i, a_i) = \cscore (y) \cdot \ctime (t)  \cdot a_i^{-1}
\end{equation}
with $\cscore(0)\geq 0$, $\cscore^\prime>0$, $\ctime(d)\geq 0$, and $\ctime^\prime<0$.

Contest design
------------------

- Fixed the prize pool, contest designer's problem is
\begin{equation}
    \text{maximize} \int y^*(x) dF(x) - \tau \int t^*(x) dF(x), \, \tau \in[0,1]. 
\end{equation}

Choice: 

- **Race**: wins the first to achieve at least a quality of $\target$ 

- **Tournament**: wins the the highest quality with time to completion less than a deadline $\deadline$


Equilibrium in a tournament
----------------------------

- Two prizes and $n\geq 3$ agents. Normalize the prize pool $V_1+V_2=1$ and use the percentage $\alpha\geq1/2$.

- The unique symmetric equilibrium of the model gives, for every $i=1, ..., n$, the optimal time to completion $t^*(a_i)$ equal to the deadline $d$ and the optimal output quality $y^*(a_i)$ as
\begin{equation}
  \label{eq: optimal bid tournament}
\cscore^{-1}\left[\cscore(0) + \frac{1}{\ctime(d)}\left(\alpha \int_{a_i}^{\infty} ... dz   + (1-\alpha) \int_{a_i}^{\infty} ...  dz\right)\right]
\end{equation}
if $\ability \geq \marginaltype$ [see @moldovanu2001optimal], and equal to zero otherwise. 

Equilibrium properties
------------------------

- Equilibrium output quality is monotonic increasing in the agent's ability [see @moldovanu2001optimal]. 

- Thus, for every $i=1, ..., n+1$, the equilibrium expected reward $\ereward$ depends only on the rank of his ability relative to the others
\begin{equation}
  \label{eq: expected payoffs tournament}
  \ereward \equiv \alpha F_A(a_i)^n  + (1-\alpha) n [1- F_A(a_i)] F_A(a_i)^{n-1}
\end{equation}

- This gives the functional relationship between the $\marginaltype$ and the parameters
\begin{equation}
  \label{eq: marginal type}
  \marginaltype = h(n, \alpha, F_A, C_0)
\end{equation}

Equilibrium in a Race
----------------------------

The unique symmetric equilibrium of the model gives, for every $i=1, ..., n$, the optimal quality $y^*(a_i)$ equal to the minimum requirement $\target$ and the optimal time to completion $t^*(a_i)$ as
\begin{equation}
  \label{eq: optimal time race}
  \ctime^{-1}\left[\ctime(d) + \frac{1}{\cscore(0)}\left(\alpha \int_{a_i}^{\infty} ... dz   + (1-\alpha) \int_{a_i}^{\infty} ...  dz\right)\right]
\end{equation}
if $\ability \geq \marginaltyperace$, and equal to zero otherwise. 

- Marginal type as
\begin{equation}
  \label{eq: marginal type race}
  \marginaltyperace = h(n, \alpha, F_A, C_{\target})
\end{equation}
with $C_{\target} \equiv \cscore(\target)\ctime(d)$ instead of $C_0$.


A comparison
-------------------


\begin{proposition}[participation]
All else equal, participation is higher in a tournament compared to a race. 
\end{proposition}

\begin{proposition}[ex-post 'efficiency']
All else equal, there always exists a subset of types $\tilde A\subset A$ for which the output quality is higher in a race compared to a tournament. 
\end{proposition}

$\implies$ races may dominate tournaments even if time to completion is unimportant ($\tau=0$)!!!

A comparison, optimal design
-------------------------

\begin{proposition}[Optimal design]
Given $\alpha$ and for $\tau>0$, the contest designer's optimal choice of a race and a tournament depends on the curvature of the cost function.
\end{proposition}

$\leadsto$ When costs are linear, a tournament allows too many entrants with low quality output and full time to completion. When costs are sufficiently convex, entry of these inefficient types is prevented in a tournament. 

$\leadsto$ Companion paper on the optimal $\alpha^*$ in preparation

A comparison, tournaments with entry requirements
-------------------------

- Many studies on minimum entry requirements in contests (and in auctions)

\begin{corollary}
All else equal, if $\tau=0$, then a tournament with sufficiently high entry requirement  dominates a race. 
\end{corollary}

$\leadsto$ entry requirement may raise $\marginaltype$ to $\marginaltyperace$ $\leadsto$ reducing participation.

Example
=============

Example: nonlinear cost functions
------------------------------------

```{r, echo=FALSE, fig.width=9.5, fig.cap="Example of non-linear cost functions with respect to output quality (left panel) and time to completion (right panel)."}

# Cost functions
cy <- function(x) x^2
ct <- function(x) 2*exp(1-x)
old.par <- par(mfrow=c(1, 2))
  curve(cy)
  curve(ct)
par(old.par)
```

Example: Log-Normal ability distribution
-----------------------------------------

```{r, echo=FALSE,  fig.width=9.5, fig.height=5, fig.cap="Private abilities are iid from the log-normal with mean 0 ($\\text{------}$) and 1 ($\\text{- - -}$)."}  
curve(dlnorm(x, meanlog=0), from=0, to=10, ylab="Density", xlab="Ability")
curve(dlnorm(x, meanlog=1), from=0, to=10, add=TRUE, lty=2)
```

Example: outcomes
---------------------------

```{r, echo=FALSE, fig.width=9.5, fig.height=5, fig.cap=list("Equilibrium bidding functions of quality in a tournament (---) and in a race (- - -) with abilities drawn from a log Normal distribution. The number of competitors and the fraction of prize pool to the winner $\\alpha$ is at the top of each panel.")}

source("../R/simulate_model.R")
z.lnorm <- f(n=c(3, 5, 10, 15, 50), V=c(1/2, 1),cy=cy, ct=ct, p=plnorm, d=dlnorm, r=rlnorm, inf.tol=20)
```

Structural model
======================

Model Estimation
--------------------

- Goal: simulate the model under different conditions

- Estimation objectives:
    - ability distribution
    - entry costs $C_0$ or $C_{\target}$

- @laffont1995econometrics's econometrics of auctions


Basic setup
------------------

- We observe $(y_i, t_i, x_l)$ from $l=1,..., L$ contests and $x_l$ vector of contest $l$ characteristics

- Ability from $a_{il}\sim F_A(\cdot | \theta, x_l)$ where $F$ is known up to $\theta$. 

- Consider entry: $y_i>0$ when $a_i > \marginaltype$, and $y_i=0$ otherwise.
\begin{equation}
  \Pr(y_i=1 | \theta, x_l) =  F_A(\marginaltype|  \theta, x_l). 
\end{equation}

- Estimation with Maximum Likelihood 
\begin{equation}
  Likelihood =  F_A(\marginaltype|  \theta, x_l)^{e} [1-F_A(\marginaltype|  \theta, x_l)]^{n-e}
\end{equation}
with $e=\sum y_i$. 

Differences with auctions
-----------------------------

- No "simultaneous" actions
    * $\leadsto$ observed $y_i$ possibly truncated at the top

- No directly observed time to completion
    * last submission can be earlier
    * first submission can be later

- Competitors are not ex-ante equal, although it is difficult to predict the winners

- Prize structure may be more complex than what described in the model (learning, reputation, etc.)





Experimental design
========================

Need of experimental data
----------------------------------------

- Observational data are rare:
    - No contests on the same problem
    - Different incentive structure, etc.
    - Competition type usually matches problem
    - Agents self-select

- Modeling needs iid data

- "Traditional" experiment without model may not be helpful


Experimental design
------------

```{r, results='asis'}
require(xtable)
load("../races.RData")
tab <- expand.grid(Competition=levels(dat$treatment), `Room size`=c("N=10", "N=15"))
print(xtable(tab, caption="Experimental design"), comment=FALSE)
```

Implementation details
-------------

- Pre-registration of 5 days
- Competition of 9 days
- Payoffs
    * Room prize: \$1000 to winner of the room, \$200 second placed
    * Grand prize: \$4000 to winner of the group
- Initial and final survey 
    * demographics
    * looking ahead / looking back
    * risk aversion
- Platform data

Our data
----------

- $>400$ pre-registered
    * 299 enrolled in the experiment (not newly registered members)

- 86 (28%) participated by making a submission

- 1,759 code submissions

- 16 passed the target of the race (8 on the final scores)

Platform experience and skills
-----------------------

```{r, echo=FALSE, fig.width=9.5, fig.cap="Signed-up competitors by the year of registration to the platform and if the competitor was ranked top 10 in one or more past competitions (high skill) or not (low skill)."}
require(xtable)

# Data preparation
ilogit <- function(x) exp(x) / (1+exp(x))
std <- function(x) sd(x)/sqrt(length(x))

# Data
target      <- 820793.00 
baseline    <- 794084.93
entry     <- !is.na(dat$nsub)
expert.y  <- dat$mm.count > 0
top10.y   <- dat$mm.top10 > 0
yr        <- as.numeric(format(dat$msince, "%Y"))
yr.f      <- factor(format(dat$msince, "%Y"))
assgn     <- dat$treatment
educ      <- dat$educ
age       <- dat$age

barplot(table(top10.y, yr.f),
        , xlab="Year of registration as member"
        , ylab="Freq."
        , legend.text=c("Low skills", "High skills")
        , args.legend = list(x = "top", bty='n'))
```

Entry and platform experience
---------------------

```{r, echo=FALSE, fig.width=9.5, fig.cap="Association between the probability of participating, individual experience, and skills by treatment. Dots show relative frequency of participants with high (dark dots) and low (red crosses) skills. Curves show the conditional probability predicted by a Probit model that is linear (---) or quadratic (- - -) in experience."}

f <- function(dat) {
  # Prepare data
  type      <- unique(dat$treatment)
  entry     <- !is.na(dat$nsub)
  top10.y   <- dat$mm.top10 > 0
  yr        <- as.numeric(format(dat$msince, "%Y"))
  yr.f      <- factor(format(dat$msince, "%Y"))
  # Fit the model
  fit.f <- glm(entry ~ yr.f + top10.y, family=binomial('probit'))
  d.f <- data.frame(expand.grid(top10.y=c(TRUE, FALSE)
                    , yr.f=levels(yr.f)))
  yhat.f <- predict(fit.f, newdata=d.f, type='response')

  plot(sort(unique(yr)), yhat.f[d.f$top10.y], pch=16, ylim=c(0, 1)
      , xlab="Year of registration as member"
      , ylab="Relative frequency"
      , main=sprintf("%s", type))
  points(sort(unique(yr)), yhat.f[!d.f$top10.y], pch=4, col=2)

  for (p in 1:2) {
    fit <- glm(entry ~ poly(yr,p) + top10.y, family=binomial('probit'))
    d <- data.frame(expand.grid(top10.y=c(TRUE, FALSE), yr=sort(unique(yr))))
    yhat <- predict(fit, newdata=d, type='response')

    lines(x=sort(unique(yr)), y=yhat[d$top10.y], lty=p)
    lines(x=sort(unique(yr)), y=yhat[!d$top10.y], lty=p, col=2)
  }
}

par(mfrow=c(1, 3))
f(subset(dat, treatment=="Race"))
f(subset(dat, treatment=="Tournament"))
f(subset(dat, treatment=="Reserve"))
```

Scores
----------

```{r, echo=FALSE, fig.cap="Association between scores and submissions by treatment."}
f <- function(dat) {
  type      <- unique(dat$treatment)
  with(dat, 
    plot(nsub, lastscore/1e5, pch=16
        , ylim=c(7.5, 8.6)
        , xlim=c(0, max(nsub,na.rm=TRUE)+15)
        , xlab="Submissions", ylab="Final score", bty='n'
        , main=type)
  ) 
  abline(h=c(target, baseline)/1e5, lty=1:2)
  text(y=c(target, baseline)/1e5, x=max(dat$nsub, na.rm=TRUE)+10, pos=1, xpd=2
      , c("Target","Baseline"))
  abline(lm(lastscore/1e5 ~ nsub, data=dat, subset=nsub>0), col=2)
#   abline(lm(lastscore/1e5 ~ nsub, data=dat, subset=nsub>0), lty=2)
}      

par(mfrow=c(1, 3))
f(subset(dat, treatment=="Race"))
f(subset(dat, treatment=="Tournament"))
f(subset(dat, treatment=="Reserve"))
```

```{r, echo=FALSE, fig.cap="Association between scores and submissions by room."}
f <- function(dat) {
  type <- unique(dat$room)
  with(dat, 
    plot(nsub, lastscore/1e5, pch=16
        , ylim=c(7.5, 8.6)
        , xlim=c(0, max(nsub,na.rm=TRUE)+15)
        , xlab="Submissions", ylab="Final score", bty='n'
        , main=type)
  ) 
  abline(h=c(target, baseline)/1e5, lty=1:2)
  text(y=c(target, baseline)/1e5, x=max(dat$nsub, na.rm=TRUE)+10, pos=1, xpd=2
      , c("Target","Baseline"))
  abline(lm(lastscore/1e5 ~ nsub, data=dat, subset=nsub>0), col=2)
}      

par(mfrow=c(6, 4), mar=c(1,1,1,1))
xlim <- range(scores$subts)
ylim <- c(7.5, 8.6)
for (i in levels(dat$room)) {
  type <- dat$treatment[which(dat$room==i)]
  ids <- subset(dat, room==i)$id
  with(subset(scores, id %in% ids)
      , plot(subts, subprov/1e5, pch=16, ylim=ylim, xlim=xlim, yaxt='n', xaxt='n'))
  abline(h=c(target, baseline)/1e5, lty=1:2)
  mtext(type, side=3, cex=0.5)
} 
```

Timing of submissions
-----------------------------------

```{r, fig.width=9.6, fig.cap="Scores and timing of the group winners."}
ts <- scores$subts
y <- scores$subsys/target
plot(ts, y, ylab="Score", xlab="Time", pch=".", col=gray(.99), bty="n")
rug(ts)

index <- scores$id=="Psyho"
points(ts[index], y[index], pch=16, col=1)
text(max(ts[index]), 0.94, "Race", xpd=T, pos=1, col=1)

index <- scores$id=="pfr"
points(ts[index], y[index], pch=17, col=2)
text(max(ts[index]), 0.92, "Tournament", xpd=T, pos=2, col=2)

index <- scores$id=="fugusuki"
points(ts[index], y[index], pch=4, col=3)
text(max(ts[index]), 1.05, "Reserve", xpd=T, pos=2, col=3)

```

Timing of submissions
---------------------------

```{r, echo=FALSE, results='asis'}
tab.cap <- "Daily frequency of submissions made. Each line indicates the submissions made by one competitor during the 9-day submission period by treatment. The '1' indicates that the competitor made at least one submission in that day, whereas the '.' indicates no submissions. Observations are ordered by the competitor's final score in decreasing order."

f <- function(dat) {
  index <- which(scores$id %in% dat$id)
  z <- scores[index, ]
  ord <- aggregate(subprov ~ id, z, max)
#  ord <- aggregate(subts ~ id, z, max) # last submission
  ord <- order(ord[, 2], decreasing=TRUE)
  m <- table(as.character(z$id), as.Date(z$subts))
  m[m>0] <- 1
  strings <- gsub("0", ".", apply(m, 1, paste, collapse=''))
  strings <- paste("\\texttt{", strings, "}", sep='')
  return(head(strings[ord], 10))
}

str.race <- f(subset(dat, treatment=='Race'))
str.tour <- f(subset(dat, treatment=='Tournament'))
str.targ <- f(subset(dat, treatment=='Reserve'))
tab <- cbind(Race=str.race, Tournament=str.tour, Target=str.targ)
print(xtable(tab, caption=tab.cap)
      , include.rownames=TRUE, comment=FALSE
      , sanitize.text.function=function(x) x)

```



```{r child = 'structural.Rmd'}
```

Conclusions
===============


Summing up
-----------------

Data consistent with theory

- Races: had the problem solved in the first 3 days
- Tournament w/target: had highest quality
- Tournament: lowest entry costs

To do next:

- Allow distribution $F$ to vary
- Estimate more complex prize structure ($\alpha\neq 1$)
- Deal with truncation/censoring issues

-------

