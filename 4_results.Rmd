
```{r results}
# Submissions
nsub <- tapply(scores$submission, scores$coder_id, max)
submissions <- tapply(scores$submission, scores$coder_id, max)

# Participation
par.percent <- round(100*tapply(submit, treatment, mean))
par.table <- table(submit, treatment)
par.test <- fisher.test(par.table)

# Participation & Size
par.percent.size <- round(100*tapply(submit, room_size, mean), 1)
par.table.size <- table(submit, room_size)
par.test.size <- fisher.test(par.table.size)
``` 

<!-- Keep past tense! -->

Results
=======

We obtained a total of `r sum(nsub)` submissions made by `r sum(submit)` participating coders (`r round(mean(100*submit))` percent of the sample). Our theoretical model predicts that participation should be higher in the tournament condition compared to the other two forms of competition. Our data were only in part consistent with this prediction: the overall response rate in the Tournament groups (`r par.percent["tournament"]` percent) was higher than that in the Race (`r par.percent["race"]` percent) and in the Reserve (`r par.percent["reserve"]` percent) condition. However, the overall association between treatments and response rates was not statistically significant (a two-sided `r par.test$method` gives a p-value of `r par.test$p.value`).

Our model also predicts lower participation for individuals in large rooms (15 competitors) compared to those in small rooms (10 competitors). Under the model, the "marginal type" is increasing in group size and so the individual probability of entry is lower. However, our data proved only negligible differences in participation between large (`r par.percent.size['Large']` percent) and small rooms (`r par.percent.size['Small']` percent).  Additionally, we found no significant treatment differences conditional on the room size being large or small (xxxxx). Hence, one may conclude that a group-size difference of 5 people is probably not large enough to be impactful.

```{r}
# Testing size!
#tab <- table(room_size, submit, treatment)
#fisher.test(tab[,,'race'])
#fisher.test(tab[,,'tournament'])
#fisher.test(tab[,,'reserve'])
#ftable(tab)
```

```{r nsub-pdf}
# Differences in submission distribution
scores2 <- merge(scores, races, by='coder_id', all.x=TRUE)
scores3 <- aggregate(submission ~ coder_id + treatment, scores2, max)

nsub_l <- split(log(scores3$submission), scores3$treatment)
nsub_l.pdf <- lapply(nsub_l, density, from=0)
nsub_l.test <- kruskal.test(nsub_l)

# T-test has more power than Kruskal or Wilcox
t.test(nsub_l$race, nsub_l$tournament)
wilcox.test(nsub_l$race, nsub_l$tournament)

# Bimodal distribution
plot.density(nsub_l.pdf)
title("Submissions distribution (in logs)")
xlab <- pretty(seq(1, 150, length=10))
```


The median submission per participant was of `r median(submissions)` submissions, with a minimum of `r min(submissions)` and a maximum of `r max(submissions)` submissions.


```{r, include=FALSE, fig.width=5, fig.height=7, fig.cap="Participation rates by rooms"}
x <- aggregate(submit ~ treatment + room + room_size, sum, data=races)
x$size <- ifelse(x$room_size=='Large', 15, 10)
x.l <- split(x, x$treatment)
par(mfrow=c(3, 1), mar=c(3, 3, 3, 1))
for (i in 1:3) {
  x <- x.l[[i]]
  p <- (x$submit + 1) / (x$size + 2)
  SE <- sqrt(p * (1-p) / x$size)
  x.title <- names(x.l)[i]
  plot(p, 1:length(p), xlim=c(0, 0.7), pch=16, main=x.title, col=x$size-5)
  segments(x0=p+SE, x1=p-SE, y0=1:length(p))
  abline(v=(sum(x$submit) + 1) / (sum(x$size)+2))
}
```

# Participation by experience

```{r}
attach(races)
mm_qtl <- cut(mm_reg, quantile(mm_reg), include=T)
chisq.test(table(submit, mm_qtl)) ## p<0.01 !!!
(tab <- ftable(treatment, submit, mm_qtl))

tothours <- week1 + week2 + week3 + week4
impute.random <- function(x) {
	index <- is.na(x)
	x[index] <- sample(x[!index], size=sum(index), replace=TRUE)
	return(x)
}
tothours_imp <- impute.random(tothours)
hours_qtl <- cut(tothours_imp, quantile(tothours_imp), include=TRUE)

mm_ratio <- mm_events / mm_reg
fit <- rep()
summary(fit$m0 <- glm(submit ~ treatment + mm_qtl + hours_qtl, binomial))
summary(fit$m0 <- glm(submit ~ treatment + mm_qtl + hours_qtl + mm_ratio, binomial))
summary(fit$m1 <- glm(submit ~ mm_qtl + hours_qtl+ mm_ratio, binomial, subset=treatment=='race'))
summary(fit$m2 <- glm(submit ~ mm_qtl + hours_qtl+ mm_ratio, binomial, subset=treatment=='tournament'))
summary(fit$m3 <- glm(submit ~ mm_qtl + hours_qtl+ mm_ratio, binomial, subset=treatment=='reserve'))

stargazer(fit, type='text')

# Tournament --> participation odds for expert coders 
# are about 40% higher in tournaments than in the race

# Nice plot with bootstrap
races$mm_qtl  <- mm_qtl
races.l <- split(races, treatment)
#table(submit, mm_qtl, treatment) -> tab
```







