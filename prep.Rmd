rm(list=ls())

#************************************************#
# Helper functions
#************************************************#
render <- function(type=c("p","n","s"))  {
	system(sprintf('sh compile.sh -%s', type))
}
percent  <- function(x, digits=0, ...) round(100 * x, digits, ...)
difftime2 <- function(...) as.numeric(difftime(...))


#************************************************#
# Prepare dataset
#************************************************#
within(races, {
	year <- as.numeric(format(member_date, '%Y'))
	hours <- week1 + week2 + week3 + week4
	rating <- mm_rating
	submissions <- mm_events
	registrations <- mm_reg
	lpaid  <- log(paid)
	male <- gender=='Male'
	grad <- educ == "Doctorate/PhD" | educ == "Postgraduate/Master of arts"
	below30 <- age == "<20 years old" | age== "20-25 years old" | age =="26-30 years"
}) -> dat


save.image()