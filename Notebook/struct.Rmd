# Identification

\newcommand\target{}
\newcommand\deadline{}

## The model

For each room $(l=1, ..., L)$, we observe the count of participants $y_l$ among the $n_l$ registered competitors who have been assigned to some treatment $w_l\in\{0, 1, 2\}$. The count of participating competitors is the realization of a random variable $Y_l$ that depends on a vector of room characteristics $z_l=(x_l, w_l)$ that include the assignment $w_l$ and additional room characteristics $x_l$. We assume that $Y_l$ is distributed as a binomial variable with parameters $n_l$ and $p(x_l, \theta)$ where $p(x, \theta)$ describes the probability for a competitor to participate in a room described by the vector $x$. The model is then the following:

\begin{equation}
	\label{model}
	Y_{l} \sim \text{Binomial}(N_l, p(x_l, \theta)) \quad \text{for each } l=1,...,L.
\end{equation}

In binomial linear models, the probability function $p(x, \theta)$ is related to a linear prediction through a one-to-one transformation called the link function (see xxxx). Following our theoretical approach, participation is one for those with abilities above a given value:

$$
	Y_{l} = 1 \iff  \text{ability}  \geq m_{l}
$$

where $m_l$ is the marginal type for the room.  Given $F_l(\cdot)$ the distribution of individual abilities in each room, the probability of entry is:

\begin{equation} 
	p(m_l, \theta) = 1 - F_l(m_l)
\end{equation}

The marginal type is determined by the zero profit condition:

\begin{equation}
	\label{zero profit}
	R_l(m_l) = m_l^\alpha y_0^\beta t_0^\gamma
\end{equation}

where the $R_l(m_l)$ is the expected revenue of the marginal type in a given room and it must be equal to the  costs evaluated at the deadline $t_0$ and the target $y_0$. 

If we assume one single prize $q=1$ (and we normalize the cost of meeting the deadline to one $t_0^\gamma=1$)  the zero profit condition becomes: 

\begin{equation}
	F_l(m_l)^{n_l-1} = m_l^\alpha y_0^\beta 
\end{equation}

By raising to the power $1/(n_l-1)$ both sides of the equation, we obtain a structural relationship between the probability of entry (eq. XXX) and the marginal type, the number of registered competitors, and the cost function.

$$
	p(x_l, \theta) = 1 - \left[m_l^\alpha y_0^\beta \right]^{1/(n_l-1)} \qquad \text{with } \alpha\leq-1, \beta\geq1.
$$


<!--
We further assume the distribution is known up to the parameters $\theta$ that we want to estimate from the data: 
$$
	F_l(x) = F(x;\theta_l). 
$$
-->

As a result, one could use a "method of moments" to estimate the parameters $\theta=(\alpha, \beta, m_l)$ ($y_0$ and $n_l$ are observed). 

## Estimation

Let $Y_1, Y_2, ..., Y_L$ be the count of participants generated by our binomial-distribution model. 
Let denote the corresponding $j$-th moment by $\mu_j$  (about the origin) of the distribution and use a hat to denote the sample moments. 

$$
	\mu_j = \frac 1n \sum x^j
$$

Equate the first sample moment to the theoretical mean:

$$
	\hat\mu_1 = n p.
$$

And equate the second sample moment to:

$$
	\hat\mu_2 = n p (1-p) + (np)^2
$$

Let further impose $\alpha=-1$. Then, we have a system of two equations with two unknowns $(\beta, m_l)$. 

```{r}
# Compute sample moments 
moments <- function(x, k) {
	mean(x^k)
} 

mom <- function(x) {
	m1 <- mean(x^1) 
}


```


```{r}
# Simulations
prob <- function(alpha, beta, n, m, y0) {
	1 - (m^alpha * y0^beta)^(1/(n-1))
}
nrooms <- 100

submit.10 <- rbinom(nrooms, size=10, prob=prob(1, 2, n=10, 0.75, 0.1))
submit.15 <- rbinom(nrooms, size=15, prob=prob(1, 2, n=15, 0.75, 0.1))

size <- c(rep(10, nrooms), rep(15, nrooms))
dat <- data.frame(y=c(submit.10, submit.15), size)
chisq.test(table(dat$y, dat$size))

# Difference in prob
rbind(tapply(dat$y/dat$size, dat$size, FUN=mean)
, c(prob(1, 2, n=10, 0.75, 0.1), prob(1, 2, n=15, 0.75, 0.1)))

```

